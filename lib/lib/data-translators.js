// Generated by CoffeeScript 1.6.3
(function() {
  var _;

  _ = require('lodash');

  /*
     converts a DynamoDB compatible JSON object into
     a native JSON object
     @param ddb the ddb JSON object
     @throws an error if input object is not compatible
     @return res the converted object
  */


  module.exports.fromDynamo = function(dbObj) {
    var element, key, _i, _len;
    if (_.isArray(dbObj)) {
      for (key = _i = 0, _len = dbObj.length; _i < _len; key = ++_i) {
        element = dbObj[key];
        dbObj[key] = module.exports.fromDynamo(element);
      }
      return dbObj;
    }
    if (_.isObject(dbObj)) {
      return _.transform(dbObj, function(res, val, key) {
        if (val.S) {
          return res[key] = val.S;
        } else if (val.SS) {
          return res[key] = val.SS;
        } else if (val.N) {
          return res[key] = parseFloat(val.N);
        } else if (val.NS) {
          return res[key] = _.map(val.NS, parseFloat);
        } else {
          throw new Error('Non Compatible Field [not "S"|"N"|"NS"|"SS"]: ' + key);
        }
      });
    } else {
      return dbObj;
    }
  };

  module.exports.toDynamo = function(item) {
    var obj, stringify;
    if (_.isArray(item)) {
      if (_.every(item, _.isNumber)) {
        return obj = {
          'NS': item
        };
      } else if (_.every(item, _.isString)) {
        if (_.any(item, function(i) {
          return i.length > 1024;
        })) {
          return obj = {
            'BS': item
          };
        } else {
          return obj = {
            'SS': item
          };
        }
      } else {
        stringify = _.map(item, function(i) {
          return JSON.stringify(i);
        });
        return obj = {
          'BS': stringify
        };
      }
    } else if (_.isNumber(item)) {
      return obj = {
        'N': item.toString()
      };
    } else if (_.isString(item)) {
      if (item.length > 1024) {
        return obj = {
          'B': item
        };
      } else {
        return obj = {
          'S': item
        };
      }
    } else if (_.isObject(item)) {
      return obj = {
        'B': JSON.stringify(item)
      };
    } else if (!item) {
      throw new TypeError('Cannot call convert_to_dynamo() with no arguments');
    }
  };

}).call(this);
